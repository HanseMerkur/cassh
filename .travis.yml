---
# Travis Doc:
#
# * Build Lifecycle
#   - https://docs.travis-ci.com/user/customizing-the-build#The-Build-Lifecycle
#
# 1. OPTIONAL Install apt addons
# 2. OPTIONAL Install cache components
# .
# 3. before_install
# 4. install
# 5. before_script
# 6. script
# 7. OPTIONAL before_cache (for cleaning up cache)
# 8. after_success or after_failure
# .
# 9. OPTIONAL before_deploy
# 10. OPTIONAL deploy
# 11. OPTIONAL after_deploy
# .
# 12. after_script (just before shutting down the build environment)
#
#
sudo: required
services:
  - docker

language: python

install:
  - echo "---> Check Docker version" && docker version
  - echo "---> Installing CI utils" && pip install docker-compose pylint

# command to run tests
script:
  # Lint
  - pylint src/client/cassh -d redefined-builtin -d useless-object-inheritance || travis_terminate 1
  - pylint src/server/server -d redefined-builtin -d useless-object-inheritance || travis_terminate 1
  # Build
  - docker-compose -f tests/docker-compose.yml build cassh-server || travis_terminate 1
  - docker-compose -f tests/docker-compose.yml build cassh-cli || travis_terminate 1
  # End2End
  - tests/tests.sh || travis_terminate 1

