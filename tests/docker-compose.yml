version: '3'

services:

  cassh-server:
    build:
      context: ../server
      dockerfile: Dockerfile
    image: nbeguier/cassh-server
    volumes:
      # Code
      - ../server:/opt/cassh/server/
      # Test config
      - ./conf/cassh_dummy.conf:/opt/cassh/server/conf/cassh.conf
      - ./test-keys:/test-keys
    ports:
      - "8080:8080"
    depends_on:
      - db

  # Backends
  db:
    image: postgres:9.5
    environment:
      POSTGRES_USER: cassh
      POSTGRES_PASSWORD: mysecretpassword
      POSTGRES_DB: cassh
    volumes:
      - ../server/sql/model.sql:/docker-entrypoint-initdb.d/cassh_model.sql